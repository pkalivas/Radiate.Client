@page "/runs/{runId:guid}"
@rendermode InteractiveServer
@using Radiate.Engines.Schema
@inherits StateComponent<Runs, AppFeature>

<MudContainer Class="mt-4 px-8" MaxWidth="MaxWidth.False">
    <MudGrid>
        
        <MudItem xs="12" sm="6" md="10">
            <MudPaper Elevation="2" Class="pa-4" Style="height: 250px;">
                <EngineInputs/>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="2">
            <MudPaper Elevation="2" Class="pa-4" Style="height: 250px;">
                <EngineControl/>
            </MudPaper>
        </MudItem>

        @if (State.ModelType == "Image")
        {
            <MudItem xs="12" sm="6" md="12">
                <MudPaper>
                    <ImageInputs/>
                </MudPaper>
            </MudItem>
        }

        <MudItem xs="12" sm="6" md="4">
            <MudPaper Elevation="2" Class="pa-4" Style="height: 200px;">
                <MetricDisplay Metric="@(State.EngineOutputs.Metrics.Get(MetricNames.FitnessDistribution))">
                    <Chart Values="@(State.GetStats(MetricNames.FitnessDistribution)?.LastSequence.ToList())" Type="line"/>
                </MetricDisplay>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6" md="4">
            <MudPaper Elevation="2" Class="pa-4" Style="height: 200px;">
                <MetricDisplay Metric="@(State.EngineOutputs.Metrics.Get(MetricNames.GenomeSizeDistribution))">
                    <Chart Values="@(State.GetStats(MetricNames.GenomeSizeDistribution)?.LastSequence.ToList())" Type="pie"></Chart>
                </MetricDisplay>
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="12" md="4">
            <MudPaper Elevation="2" Class="pa-4" Style="height: 200px;">
                <MetricDisplay Metric="@(State.EngineOutputs.Metrics.Get(MetricNames.AgeDistribution))">
                    <Chart Values="@(State.GetStats(MetricNames.AgeDistribution)?.LastSequence.ToList())" Type="bar"></Chart>
                </MetricDisplay>            
            </MudPaper>
        </MudItem>

        <MudItem xs="12" sm="6">
            <MudGrid>
                <MudItem xs="12">
                    <MudPaper Elevation="2" Class="pa-4 overflow-auto" Style="height: 200px;">
                        <EngineStateTree/>
                    </MudPaper>
                </MudItem>
                <MudItem xs="12">
                    <MudPaper Elevation="2" Class="pa-4" Style="height: 200px;">
                        <MetricValueDisplay Value="@State.GetStats(MetricNames.Score)?.LastValue">
                            <Chart Values="@State.Scores" Type="line"/>
                        </MetricValueDisplay>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudItem>

        <MudItem xs="12" sm="6">
            <EngineOutputs/>
        </MudItem>

    </MudGrid>
</MudContainer>

<TestFe/>

@code {
    [Parameter] public Guid RunId { get; set; }
}
