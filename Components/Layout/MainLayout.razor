@using Radiate.Client.Components.Store.Interfaces
@using Radiate.Client.Components.Store.States.Features
@inherits LayoutComponentBase
@implements IDisposable

<MudThemeProvider IsDarkMode="true"/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<MudLayout>
    <MudAppBar>
        <MudButton OnClick="@(() => Dispatcher.Dispatch<LayoutChangedAction, RootFeature>(new LayoutChangedAction { IsSidebarOpen = !_drawerOpen }))"><MudIcon Icon="@Icons.Material.Filled.Menu"></MudIcon></MudButton>
        Radiate Client
    </MudAppBar>
    <MudDrawer @bind-Open="@_drawerOpen">
        <NavMenu/>
    </MudDrawer>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>


@code {
    bool _drawerOpen = true;
    
    [Inject] private IStore Store { get; set; }
    [Inject] private IDispatcher Dispatcher { get; set; }
    
    protected override Task OnInitializedAsync()
    {
        Store.Select<LayoutState>().SelectedValueChanged += SetDrawerOpen!;
        return base.OnInitializedAsync();
    }

    void DrawerToggle(bool open)
    {
        Dispatcher.Dispatch<LayoutChangedAction, RootFeature>(new LayoutChangedAction { IsSidebarOpen = open });
    }

    public void Dispose()
    {
        Store.Select<LayoutState>().SelectedValueChanged -= SetDrawerOpen!;
    }
    
    private void SetDrawerOpen(object sender, LayoutState state)
    {
        InvokeAsync(() =>
        {
            _drawerOpen = state.IsSidebarOpen;
            StateHasChanged();
        });
    }

}