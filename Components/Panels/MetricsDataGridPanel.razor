@using System.Reactive.Linq
@using Radiate.Engines.Schema
@using System.Collections.ObjectModel
@using System.Collections.Specialized
@using Radiate.Client.Services.Store.Actions
@using System.Collections
@inherits StoreComponent<MetricListModel>


<MudDataGrid Dense="true" Elevation="0"
             Items="@Model.Values"
             FixedHeader="true"
             Virtualize="true"
             SelectedItems="@Model.SelectedMetrics">
    <Columns>
        <PropertyColumn StickyLeft="true" Property="x => FormatName(x.Name)" Title="Name" Hideable="false" Filterable="true"/>
        <PropertyColumn Property="x => x.Value" Title="Value" Hideable="true" />
        <PropertyColumn Property="x => x.Min" Title="Min" Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Max" Title="Max" Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Mean" Title="Avg." Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Variance" Title="Var." Hidden="true" Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Kurtosis" Title="Kurt." Hidden="true" Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => x.Skewness" Title="Skew." Hidden="true" Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => FormatDuration(x.MeanTime)" Title="Avg. Duration" Hideable="true" Groupable="true" Filterable="true"/>
        <PropertyColumn Property="x => FormatDuration(x.Total)" Title="Duration" Hideable="true" Groupable="true" Filterable="true"/>
    </Columns>
</MudDataGrid>

@code {

    protected override IObservable<MetricListModel> Select() =>
        Store.Select(RunSelectors.SelectCurrentMetricsList);

    private string FormatDuration(TimeSpan duration) => duration.ToString("mm\\:ss\\:ffff");

    private string FormatName(string name) => name.Split("`")[0];
}