@using Radiate.Client.Components.Store.Schema
@using Radiate.Client.Services.Runners
@inherits StateComponent
@inject IWorkItemQueue WorkItemQueue
@inject EngineRunnerFactory Runner

<MudDialog>
    <DialogContent>
        <div>
            <MudSelect SelectedValuesChanged="@OnModelChange" MultiSelection="false" HelperText="Model To Run" T="string" Label="Model" Variant="Variant.Text">
                @foreach (var model in StateOptions.ModelNames)
                {
                    <MudSelectItem Value="@model"/>
                }
            </MudSelect>
        </div>
        <div>
            <MudSelect SelectedValuesChanged="@OnDataSetChange" HelperText="DataSet To Run" T="string" Label="DataSet" Variant="Variant.Text">
                @foreach (var data in StateOptions.DataSetNames)
                {
                    <MudSelectItem Value="@data"/>
                }
            </MudSelect>
        </div>
        <div class="mt-3">
            <h5>Genetic Inputs</h5>
            <MudDivider/>
            <div class="col">
                <MudNumericField Label="Population Size"
                                 Variant="Variant.Filled"
                                 Value="@State.EngineInputs.PopulationSize"
                                 ValueChanged="@((int size) => Dispatch(state => state.EngineInputs.PopulationSize = size))">
                </MudNumericField>
                <MudNumericField Label="Mutation Rate"
                                 Variant="Variant.Filled"
                                 Value="@State.EngineInputs.MutationRate"
                                 ValueChanged="@((float rate) => Dispatch(state => state.EngineInputs.MutationRate = rate))">
                </MudNumericField>
                <MudNumericField Label="Max Epochs"
                                 Variant="Variant.Filled"
                                 Value="@State.EngineInputs.IterationLimit"
                                 ValueChanged="@((int limit) => Dispatch(state => state.EngineInputs.IterationLimit = limit))">
                </MudNumericField>
            </div>    
        </div>
        
        <MudDivider/>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Start</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    
    private RunsState RunState { get; set; }

    protected override void OnInitialized()
    {
        RunState = new RunsState();
        base.OnInitialized();
    }

    void Cancel() => MudDialog.Cancel();

    void Submit()
    {
        MudDialog.Close(DialogResult.Ok(true));  
    } 

    private void OnModelChange(IEnumerable<string> model)
    {
        Dispatch(state => state.ModelType = model.First());
    }
    
    private void OnDataSetChange(IEnumerable<string> value)
    {
        Dispatch(state => state.DataSetType = value.First());
    }
}