@page "/runs/{runId:guid}/graph"
@rendermode InteractiveServer
@inject IDialogService DialogService

<MudContainer Class="mt-4 px-8" MaxWidth="MaxWidth.False">
    <MudGrid>
        
        <MudItem md="6">
            <MudItem>
                <MudPaper Elevation="2" Class="pa-4">
                    <GraphInputsPanel/>
                </MudPaper>
            </MudItem>
        </MudItem>
        
        <MudItem md="6">
            <MudItem>
                <MudPaper Elevation="2" Class="pa-4">
                    <EngineControl/>
                </MudPaper>
            </MudItem>
        </MudItem>

        <MudItem md="8">

            <MudExpansionPanels Dense="true" Elevation="0" MultiExpansion="true">

                @* <MudExpansionPanel Dense="true" IsInitiallyExpanded="true"> *@
                @*     <TitleContent> *@
                @*         <PanelHeaderPanel Title="Inputs"/> *@
                @*     </TitleContent> *@
                @*     <ChildContent> *@
                @*         <MudDivider/> *@
                @*         <EngineInputs/> *@
                @*         <div class="d-flex flex-row-reverse w-100"> *@
                @*             <div class="mt-2 mb-2"> *@
                @*                 <EngineControl/> *@
                @*             </div> *@
                @*         </div> *@
                @*     </ChildContent> *@
                @* </MudExpansionPanel> *@

                <MudExpansionPanel Dense="true" IsInitiallyExpanded="true" MaxHeight="200">
                    <TitleContent>
                        <PanelHeaderPanel Title="Score"/>
                    </TitleContent>
                    <ChildContent>
                        <MudDivider/>
                        <ScorePanel/>
                    </ChildContent>
                </MudExpansionPanel>

                <MudExpansionPanel Dense="true" IsInitiallyExpanded="true">
                    <TitleContent>
                        <PanelHeaderPanel Title="Metrics"/>
                    </TitleContent>
                    <ChildContent>
                        <MudDivider/>
                        <MetricsDataGridPanel/>
                    </ChildContent>
                </MudExpansionPanel>

            </MudExpansionPanels>
        </MudItem>

        <MudItem md="4">
            <MudExpansionPanels Dense="true" Elevation="0" MultiExpansion="true">

                <MudExpansionPanel Dense="true" IsInitiallyExpanded="true" MaxHeight="150">
                    <TitleContent>
                        <div class="d-flex">
                            <MudText Typo="Typo.body1">Fitness Distribution</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <MudDivider/>
                        <MetricSummary MetricName="@MetricNames.FitnessDistribution" ChartHeight="125" ChartType="line"/>
                    </ChildContent>
                </MudExpansionPanel>

                <MudExpansionPanel Dense="true" IsInitiallyExpanded="true" MaxHeight="150">
                    <TitleContent>
                        <div class="d-flex">
                            <MudText Typo="Typo.body1">Age Distribution</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <MudDivider/>
                        <MetricSummary MetricName="@MetricNames.AgeDistribution" ChartHeight="125" ChartType="bar"/>
                    </ChildContent>
                </MudExpansionPanel>

                <MudExpansionPanel Dense="true" IsInitiallyExpanded="true" MaxHeight="150">
                    <TitleContent>
                        <div class="d-flex">
                            <MudText Typo="Typo.body1">Genome Size Distribution</MudText>
                        </div>
                    </TitleContent>
                    <ChildContent>
                        <MudDivider/>
                        <MetricSummary MetricName="@MetricNames.GenomeSizeDistribution" ChartHeight="125" ChartType="pie"/>
                    </ChildContent>
                </MudExpansionPanel>

            </MudExpansionPanels>
        </MudItem>

    </MudGrid>
</MudContainer>

@code {
    
    [Parameter] public Guid RunId { get; set; }
    
    private async Task OpenEngineTree()
    {
        var options = new DialogOptions
        {
            MaxWidth = MaxWidth.Medium,
            FullWidth = true,
            CloseOnEscapeKey = true,
        };

        var dialogRef = await DialogService.ShowAsync<EngineStateTree>("Engine Tree", options);
        await dialogRef.Result;
    }
}