@using Radiate.Client.Components.Store.Schema

<MudDialog>
    <DialogContent>
        <div>
            <MudSelect SelectedValuesChanged="@OnModelChange" 
                       Value="@RunState.Inputs.ModelType" 
                       MultiSelection="false"
                       HelperText="Model To Run"
                       T="string"
                       Label="Model"
                       Variant="Variant.Text">
                @foreach (var model in StateOptions.ModelNames)
                {
                    <MudSelectItem Value="@model"/>
                }
            </MudSelect>
        </div>
        <div>
	        <MudSelect SelectedValuesChanged="@OnDataSetChange"
	                   Value="@RunState.Inputs.DataSetType"
	                   MultiSelection="false"
	                   HelperText="DataSet To Run"
	                   T="string"
	                   Label="DataSet"
	                   Variant="Variant.Text">
                @if (RunState.Inputs.ModelType == "Image")
                {
                    @foreach (var data in StateOptions.ImageDataSetNames)
                    {
	                    <MudSelectItem Value="@data"/>
                    }
                }
                else
                {
	                @foreach (var data in StateOptions.DataSetNames)
	                {
		                <MudSelectItem Value="@data"/>
	                }
                }
	        </MudSelect>
        </div>
        <div class="mt-3">
            <h5>Genetic Inputs</h5>
            <MudDivider/>
            <div class="col">
                <MudNumericField Label="Population Size"
                                 Variant="Variant.Filled"
                                 Value="@RunState.Inputs.PopulationSize"
                                 ValueChanged="@((int size) => RunState.Inputs.PopulationSize = size)">
                </MudNumericField>
                <MudNumericField Label="Mutation Rate"
                                 Variant="Variant.Filled"
                                 Value="@RunState.Inputs.MutationRate"
                                 ValueChanged="@((float rate) => RunState.Inputs.MutationRate = rate)">
                </MudNumericField>
                <MudNumericField Label="Max Epochs"
                                 Variant="Variant.Filled"
                                 Value="@RunState.Inputs.IterationLimit"
                                 ValueChanged="@((int limit) => RunState.Inputs.IterationLimit = limit)">
                </MudNumericField>
            </div>    
        </div>
        
        <MudDivider/>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" OnClick="Submit">Start</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }
    
    private RunState RunState { get; set; }

    protected override void OnInitialized()
    {
        RunState = new RunState();
        base.OnInitialized();
    }

    void Cancel() => MudDialog.Cancel();

    void Submit() => MudDialog.Close(DialogResult.Ok(RunState)); 

    private void OnModelChange(IEnumerable<string> model)
    {
        var selectedModel = model.First();
        if (RunState.Inputs.ModelType == "Image" && selectedModel != "Image")
        {
	        RunState.Inputs.DataSetType = "Graph";
        }

        RunState.Inputs.ModelType = model.First();
        if (RunState.Inputs.ModelType == "Image")
        {
	        RunState.Inputs.DataSetType = "Polygon";
        }
    }
    
    private void OnDataSetChange(IEnumerable<string> value)
    {
        RunState.Inputs.DataSetType = value.First();
    }
}