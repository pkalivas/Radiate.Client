@using Color = MudBlazor.Color
@using Image = SixLabors.ImageSharp.Image
@using Size = MudBlazor.Size
@inherits StateComponent<EngineControl, RunState>

@if (State.IsRunning)
{
    <MudButton Class="w-100"
               Size="Size.Small"
               Variant="Variant.Filled"
               Color="Color.Secondary"
               OnClick="@Stop">
        Stop
    </MudButton>
}
else
{
    <MudButton Size="Size.Small" Color="Color.Tertiary" Variant="Variant.Filled" Class="float-right" OnClick="@Start">
        <MudIcon Icon="@Icons.Material.Filled.PlayArrow" Class="ml-0 mr-2" Size="Size.Small"/>
        Run
    </MudButton>
}

@code {
    
    private void Start() => Dispatcher.Dispatch<StartEngineAction, RootFeature>(new StartEngineAction(State.RunId));

    private void Stop() => Dispatcher.Dispatch<CancelEngineRunAction, RootFeature>(new CancelEngineRunAction(State.RunId));
    
    // private void OnResultCreated(EngineOutputState output) => 
    //     InvokeAsync(() =>
    //     {
    //         Dispatch(new FunctionalAction(state => state.EngineOutputs = output));
    //         Dispatch(state => state.Scores.Add(output.Metrics.Get(MetricNames.Score).Statistics.LastValue));
    //         
    //         if (output.Outputs.Any(val => val.Name == "Image"))
    //         {
    //             var image = output.GetOutputValue<string>("Image");
    //             Dispatch(state => state.ImageState.Current = new ImageEntity
    //             {
    //                 ImageData = Image.Load<Rgba32>(Convert.FromBase64String(image)),
    //             });
    //         }
    //
    //         if (output.EngineState is EngineStateTypes.Stopped)
    //         {
    //             Dispatch(state => state.Running = false);
    //         }
    //     });
}